<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>商談キット｜納得のための整理（単価・数量・自動化）</title>
  <meta name="description" content="費用差額を限界利益率で売上換算し、単価・数量・自動化のどこで回収するかを同じ画面で整理します。" />

  <style>
    :root{
      --brand:#578899;
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#17323a;
      --muted:#56707a;
      --line:rgba(23,50,58,.12);
      --soft:rgba(87,136,153,.10);
      --shadow:0 10px 28px rgba(20,40,50,.10);
      --r:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height:1.55;
    }
    a{color:inherit}
    .top{
      position:sticky; top:0; z-index:10;
      background:rgba(246,248,251,.88);
      backdrop-filter:saturate(1.2) blur(10px);
      border-bottom:1px solid var(--line);
    }
    .topin{
      max-width:980px; margin:0 auto;
      padding:10px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; min-width:0;
    }
    .logo{
      width:34px; height:34px; border-radius:10px;
      background:linear-gradient(180deg, rgba(87,136,153,.30), rgba(87,136,153,.12));
      border:1px solid rgba(87,136,153,.35);
    }
    .btxt{min-width:0}
    .bttl{font-weight:900; font-size:14px}
    .bsub{font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .btns{display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end}
    .btn{
      appearance:none;
      border:1px solid var(--line);
      background:#fff;
      color:var(--text);
      border-radius:12px;
      padding:9px 12px;
      font-weight:800;
      cursor:pointer;
      box-shadow:0 2px 0 rgba(0,0,0,.02);
      transition:.12s transform,.12s box-shadow,.12s border-color;
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 10px 18px rgba(20,40,50,.08); border-color:rgba(87,136,153,.35)}
    .btn.primary{background:var(--soft); border-color:rgba(87,136,153,.35)}
    .btn.ghost{background:transparent}
    .wrap{max-width:980px; margin:0 auto; padding:16px 14px 42px}
    .grid{display:grid; gap:12px}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--r);
      padding:14px;
      box-shadow:var(--shadow);
    }
    h2{margin:0 0 8px; font-size:18px}
    .p{margin:6px 0 0; color:var(--muted)}
    .steps{
      display:flex; gap:8px; flex-wrap:wrap;
      margin-top:10px;
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(87,136,153,.22);
      background:rgba(87,136,153,.06);
      font-size:12px;
      color:var(--muted);
      font-weight:800;
    }
    .chip b{color:var(--text)}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width:760px){ .row{grid-template-columns:1fr} }
    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px; font-weight:800}
    input{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(23,50,58,.14);
      background:#fff;
      color:var(--text);
      font-size:16px;
      outline:none;
    }
    input:focus{
      border-color:rgba(87,136,153,.55);
      box-shadow:0 0 0 4px rgba(87,136,153,.16);
    }
    .help{font-size:12px; color:var(--muted); margin-top:6px}
    .kpi{display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-top:10px}
    @media (max-width:760px){ .kpi{grid-template-columns:1fr} }
    .k{
      border:1px solid rgba(23,50,58,.10);
      border-radius:14px;
      padding:12px;
      background:rgba(87,136,153,.04);
    }
    .k .t{font-size:12px; color:var(--muted); font-weight:800}
    .k .v{font-size:18px; font-weight:900; margin-top:6px}
    .routes{display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; margin-top:10px}
    @media (max-width:900px){ .routes{grid-template-columns:1fr} }
    .route{
      border:1px solid rgba(23,50,58,.12);
      border-radius:16px;
      padding:14px;
      background:#fff;
    }
    .route h3{margin:0 0 6px; font-size:16px}
    .route .desc{margin:0; color:var(--muted); font-size:12px}
    .mini{margin-top:10px}
    .mini .kpi2{display:grid; grid-template-columns:1fr; gap:8px; margin-top:10px}
    .k2{
      border:1px solid rgba(23,50,58,.10);
      border-radius:14px;
      padding:12px;
      background:rgba(87,136,153,.04);
    }
    .k2 .t{font-size:12px; color:var(--muted); font-weight:800}
    .k2 .v{font-size:16px; font-weight:900; margin-top:6px}
    details{margin-top:10px}
    summary{cursor:pointer; font-weight:900; color:var(--text)}
    .foot{margin-top:12px; color:var(--muted); font-size:12px}
    .note{
      border:1px solid rgba(87,136,153,.28);
      background:rgba(87,136,153,.06);
      border-radius:14px;
      padding:12px;
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
    }

    /* modal (same screen) */
    .modalBack{
      position:fixed; inset:0; z-index:100;
      background:rgba(10,20,25,.35);
      display:none; align-items:center; justify-content:center;
      padding:14px;
    }
    .modal{
      width:min(1040px, 96vw);
      height:min(720px, 86vh);
      background:#fff;
      border-radius:18px;
      border:1px solid rgba(23,50,58,.14);
      box-shadow:0 18px 50px rgba(0,0,0,.18);
      display:flex; flex-direction:column; overflow:hidden;
    }
    .modalTop{
      padding:10px 12px;
      border-bottom:1px solid rgba(23,50,58,.10);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background:rgba(246,248,251,.92);
    }
    .modalTitle{font-weight:900; font-size:13px; color:var(--text); min-width:0}
    .modalTitle span{color:var(--muted); font-weight:800; font-size:12px}
    .modalFrame{
      flex:1;
      background:#fff;
    }
    iframe{
      width:100%; height:100%; border:0;
      background:#fff;
    }
    .modalHint{
      padding:10px 12px;
      border-top:1px solid rgba(23,50,58,.10);
      color:var(--muted);
      font-size:12px;
      background:#fff;
    }
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
  </style>
</head>

<body>
  <div class="top">
    <div class="topin">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="btxt">
          <div class="bttl">商談キット（納得のための整理）</div>
          <div class="bsub">売上換算 → 単価 / 数量 / 自動化 の道筋を同じ画面で確認</div>
        </div>
      </div>
      <div class="btns">
        <button class="btn ghost" id="btnCopy">要点をコピー</button>
        <button class="btn primary" id="btnReset">リセット</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">

      <!-- STEP 1 -->
      <section class="card">
        <h2>1. まず「物差し」を揃える（売上換算・簡易）</h2>
        <div class="p">費用差額を、限界利益率で「必要な売上」に換算して整理します（概算）。</div>

        <div class="steps">
          <div class="chip"><b>入力</b>：差額（月）</div>
          <div class="chip"><b>入力</b>：限界利益率</div>
          <div class="chip"><b>任意</b>：年商 / 月商</div>
        </div>

        <div class="row" style="margin-top:12px;">
          <div>
            <label for="feeDiff">費用差額（円 / 月）</label>
            <input id="feeDiff" inputmode="numeric" placeholder="例：20000" />
            <div class="help">例：顧問料の差額、追加したい投資額など。</div>
          </div>
          <div>
            <label for="cmr">限界利益率（%）</label>
            <input id="cmr" inputmode="decimal" placeholder="例：30" />
            <div class="help">わからなければ、仮の数値で「目安」を確認できます。</div>
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div>
            <label for="annualSales">年商（任意 / 円）</label>
            <input id="annualSales" inputmode="numeric" placeholder="例：120000000" />
            <div class="help">入力すると「年商の何%か」を表示します。</div>
          </div>
          <div>
            <label for="monthlySales">月商（任意 / 円）</label>
            <input id="monthlySales" inputmode="numeric" placeholder="例：10000000" />
            <div class="help">単価ルートの「必要な単価改善率（目安）」が表示できます。</div>
          </div>
        </div>

        <div class="kpi">
          <div class="k">
            <div class="t">必要売上（円 / 月）</div>
            <div class="v" id="needSalesM">—</div>
          </div>
          <div class="k">
            <div class="t">必要売上（円 / 年）</div>
            <div class="v" id="needSalesY">—</div>
          </div>
          <div class="k">
            <div class="t">年商に占める割合（%）</div>
            <div class="v" id="shareY">—</div>
          </div>
        </div>

        <div class="note">
          入力値はこの端末内で計算され、送信されません（このページ単体で完結する設計）。必要に応じて、下のツールで追加の検証ができます。
        </div>
      </section>

      <!-- STEP 2 -->
      <section class="card">
        <h2>2. 道筋を選ぶ（単価 / 数量 / 自動化）</h2>
        <div class="p">「必要売上」を、どの道筋で作るかを整理します。ここから先は、会社ごとに最適解が変わります。</div>

        <div class="routes">
          <!-- 単価 -->
          <div class="route">
            <h3>単価を上げる</h3>
            <p class="desc">月商に対して、どの程度の単価改善が必要か（目安）。</p>

            <div class="mini">
              <div class="kpi2">
                <div class="k2">
                  <div class="t">必要な単価改善率（%）※月商入力時</div>
                  <div class="v" id="needPricePct">—</div>
                </div>
              </div>

              <div class="btns" style="margin-top:10px; justify-content:flex-start;">
                <button class="btn primary" data-open="price">価格改定ツールで確認</button>
              </div>

              <details>
                <summary>話し方メモ（任意）</summary>
                <div class="foot">
                  「必要売上は <span class="mono">差額 ÷ 限界利益率</span> で整理できます。<br/>
                  次に、単価（価格）側で作るのか、数量側で作るのか、あるいは自動化で時間を作るのかを一緒に決めましょう。」
                </div>
              </details>
            </div>
          </div>

          <!-- 数量 -->
          <div class="route">
            <h3>数量を上げる</h3>
            <p class="desc">平均単価から、必要な追加件数（目安）を整理します。</p>

            <div class="mini">
              <label for="avgPrice">平均単価（円 / 任意）</label>
              <input id="avgPrice" inputmode="numeric" placeholder="例：12000" />
              <div class="help">入力すると「必要な追加件数（目安）」を表示します。</div>

              <div class="kpi2">
                <div class="k2">
                  <div class="t">必要な追加件数（件/個 など / 月）</div>
                  <div class="v" id="needMoreUnits">—</div>
                </div>
              </div>

              <div class="btns" style="margin-top:10px; justify-content:flex-start;">
                <button class="btn primary" data-open="pl">変動PLツールで確認</button>
              </div>
            </div>
          </div>

          <!-- 自動化 -->
          <div class="route">
            <h3>経理プロセスを自動化する</h3>
            <p class="desc">差額を「削減できる時間」で整理します（目安）。</p>

            <div class="mini">
              <label for="hourCost">時間単価（円 / 時）</label>
              <input id="hourCost" inputmode="numeric" placeholder="例：3000" />
              <div class="help">入力すると「必要な削減時間（目安）」を表示します。</div>

              <div class="kpi2">
                <div class="k2">
                  <div class="t">回収に必要な削減時間（h / 月）</div>
                  <div class="v" id="needHours">—</div>
                </div>
              </div>

              <div class="btns" style="margin-top:10px; justify-content:flex-start;">
                <button class="btn primary" data-open="auto">自動化効果ツールで確認</button>
              </div>
            </div>
          </div>
        </div>

        <div class="foot">
          ※ここで表示する数値は「会話を前に進めるための目安」です。実際の施策は、対象範囲・実行タイミング・運用条件を合わせて設計します。
        </div>
      </section>

      <!-- STEP 3 -->
      <section class="card">
        <h2>3. 次の一手（その場で決める）</h2>
        <div class="p">「何を」「いつから」「どの指標で確認するか」を決めると、納得感が上がり、判断がブレにくくなります。</div>
        <div class="steps">
          <div class="chip"><b>対象</b>：商品 / 客層 / 業務</div>
          <div class="chip"><b>実行日</b>：いつから</div>
          <div class="chip"><b>確認</b>：月次の指標（単価 / 件数 / 締め日 など）</div>
        </div>
      </section>

    </div>
  </div>

  <!-- modal -->
  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true" aria-label="ツール表示">
    <div class="modal">
      <div class="modalTop">
        <div class="modalTitle" id="modalTitle">ツールを表示 <span>（同一画面）</span></div>
        <div class="btns">
          <button class="btn" id="btnOpenNewTab">別タブで開く</button>
          <button class="btn primary" id="btnClose">閉じる</button>
        </div>
      </div>
      <div class="modalFrame">
        <iframe id="toolFrame" title="tool"></iframe>
      </div>
      <div class="modalHint">
        もし表示されない場合は「別タブで開く」をご利用ください（ブラウザ側の制限で埋め込み表示ができない場合があります）。
      </div>
    </div>
  </div>

  <script>
    // ====== 設定：ツールURL（必要に応じて差替え） ======
    const TOOL_URLS = {
      // LPから辿れるURL（確認済み）
      pl:    "https://takatrp.github.io/hendou_PL_LP/",
      auto:  "https://takatrp.github.io/jidouka-kouka-LP/",
      price: "https://takatrp.github.io/price-up-down-LP/"
      // ここに「売上換算ツール（詳細版）」がある場合は追記して使ってください（このページ内で簡易換算は完結します）
      // sales: "https://...."
    };

    const KEY = "mk_shodan_kit_v1";

    const $ = (id)=>document.getElementById(id);

    function num(v){
      if(v==null) return 0;
      const s = String(v).trim()
        .replace(/[,，\s]/g,'')
        .replace(/[・]/g,'.');
      const n = Number(s);
      return Number.isFinite(n) ? n : 0;
    }
    function yen(n){
      if(!Number.isFinite(n)) return "—";
      const r = Math.round(n);
      return "¥" + r.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    function pct(n){
      if(!Number.isFinite(n)) return "—";
      return (Math.round(n*10)/10).toString() + "%";
    }
    function ceil1(n){
      if(!Number.isFinite(n)) return "—";
      return (Math.ceil(n*10)/10).toString();
    }

    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        return raw ? JSON.parse(raw) : {};
      }catch(e){ return {}; }
    }
    function save(){
      try{
        localStorage.setItem(KEY, JSON.stringify({
          feeDiff: $("feeDiff").value,
          cmr: $("cmr").value,
          annualSales: $("annualSales").value,
          monthlySales: $("monthlySales").value,
          avgPrice: $("avgPrice").value,
          hourCost: $("hourCost").value
        }));
      }catch(e){}
    }
    function apply(v){
      if(v.feeDiff!=null) $("feeDiff").value = v.feeDiff;
      if(v.cmr!=null) $("cmr").value = v.cmr;
      if(v.annualSales!=null) $("annualSales").value = v.annualSales;
      if(v.monthlySales!=null) $("monthlySales").value = v.monthlySales;
      if(v.avgPrice!=null) $("avgPrice").value = v.avgPrice;
      if(v.hourCost!=null) $("hourCost").value = v.hourCost;
    }

    function render(){
      const feeDiff = num($("feeDiff").value);
      const cmr = num($("cmr").value);
      const annualSales = num($("annualSales").value);
      const monthlySales = num($("monthlySales").value);
      const avgPrice = num($("avgPrice").value);
      const hourCost = num($("hourCost").value);

      const needSalesM = (cmr>0) ? feeDiff / (cmr/100) : NaN;
      const needSalesY = Number.isFinite(needSalesM) ? needSalesM * 12 : NaN;
      $("needSalesM").textContent = Number.isFinite(needSalesM) ? yen(needSalesM) : "—";
      $("needSalesY").textContent = Number.isFinite(needSalesY) ? yen(needSalesY) : "—";

      const shareY = (annualSales>0 && Number.isFinite(needSalesY)) ? (needSalesY/annualSales*100) : NaN;
      $("shareY").textContent = Number.isFinite(shareY) ? pct(shareY) : "—";

      const needPricePct = (monthlySales>0 && Number.isFinite(needSalesM)) ? (needSalesM/monthlySales*100) : NaN;
      $("needPricePct").textContent = Number.isFinite(needPricePct) ? pct(needPricePct) : "—";

      const needMoreUnits = (avgPrice>0 && Number.isFinite(needSalesM)) ? (needSalesM/avgPrice) : NaN;
      $("needMoreUnits").textContent = Number.isFinite(needMoreUnits) ? (ceil1(needMoreUnits) + "（/月）") : "—";

      const needHours = (hourCost>0) ? (feeDiff/hourCost) : NaN;
      $("needHours").textContent = Number.isFinite(needHours) ? (ceil1(needHours) + " h/月") : "—";

      save();
    }

    // modal open (same screen)
    let currentUrl = "";
    function openModal(title, url){
      currentUrl = url;
      $("modalTitle").textContent = title + "（同一画面）";
      $("toolFrame").src = url;
      $("modalBack").style.display = "flex";
    }
    function closeModal(){
      $("modalBack").style.display = "none";
      $("toolFrame").src = "about:blank";
      currentUrl = "";
    }

    // bind tool buttons
    document.querySelectorAll("[data-open]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const key = btn.getAttribute("data-open");
        const url = TOOL_URLS[key];
        if(!url){
          alert("ツールURLが未設定です（TOOL_URLSを確認してください）。");
          return;
        }
        const title =
          key==="pl" ? "変動PLツール" :
          key==="auto" ? "自動化効果ツール" :
          key==="price" ? "価格改定ツール" :
          "ツール";
        openModal(title, url);
      });
    });

    $("btnClose").addEventListener("click", closeModal);
    $("modalBack").addEventListener("click", (e)=>{ if(e.target === $("modalBack")) closeModal(); });
    window.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeModal(); });

    $("btnOpenNewTab").addEventListener("click", ()=>{
      if(currentUrl) window.open(currentUrl, "_blank", "noopener,noreferrer");
    });

    // copy
    $("btnCopy").addEventListener("click", async ()=>{
      const feeDiff = num($("feeDiff").value);
      const cmr = num($("cmr").value);
      const annualSales = num($("annualSales").value);
      const monthlySales = num($("monthlySales").value);
      const avgPrice = num($("avgPrice").value);
      const hourCost = num($("hourCost").value);

      const needSalesM = (cmr>0) ? feeDiff / (cmr/100) : NaN;
      const needSalesY = Number.isFinite(needSalesM) ? needSalesM * 12 : NaN;
      const shareY = (annualSales>0 && Number.isFinite(needSalesY)) ? (needSalesY/annualSales*100) : NaN;
      const needPricePct = (monthlySales>0 && Number.isFinite(needSalesM)) ? (needSalesM/monthlySales*100) : NaN;
      const needMoreUnits = (avgPrice>0 && Number.isFinite(needSalesM)) ? (needSalesM/avgPrice) : NaN;
      const needHours = (hourCost>0) ? (feeDiff/hourCost) : NaN;

      const text =
`【納得のための整理（概算）】
・差額（月）：${yen(feeDiff)}
・限界利益率：${cmr ? (cmr + "%") : "—"}
・必要売上：${Number.isFinite(needSalesM)?yen(needSalesM):"—"}/月（年 ${Number.isFinite(needSalesY)?yen(needSalesY):"—"}）
・年商比：${Number.isFinite(shareY)?pct(shareY):"—"}

道筋の目安：
・単価：${Number.isFinite(needPricePct)?("月商に対して " + pct(needPricePct)):"（月商入力で表示）"}
・数量：${Number.isFinite(needMoreUnits)?(ceil1(needMoreUnits) + "/月"):"（平均単価入力で表示）"}
・自動化：${Number.isFinite(needHours)?(ceil1(needHours) + "h/月"):"（時間単価入力で表示）"}`;
      try{
        await navigator.clipboard.writeText(text);
        const b = $("btnCopy"); const old = b.textContent;
        b.textContent = "コピーしました";
        setTimeout(()=>b.textContent=old, 900);
      }catch(e){
        alert("コピーできない場合があります。必要なら画面の数値をそのままご利用ください。");
      }
    });

    // reset
    $("btnReset").addEventListener("click", ()=>{
      ["feeDiff","cmr","annualSales","monthlySales","avgPrice","hourCost"].forEach(id=>$(id).value="");
      localStorage.removeItem(KEY);
      render();
    });

    // inputs
    ["feeDiff","cmr","annualSales","monthlySales","avgPrice","hourCost"].forEach(id=>{
      $(id).addEventListener("input", render);
    });

    // init
    apply(load());
    render();
  </script>
</body>
</html>